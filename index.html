<!DOCTYPE html>
<html lang="es">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Kindle Lens Reader v4</title>
        <style>
                :root {
                        --primary: #4285F4;
                        --bg: #000000;
                        --panel: #1a1a1a;
                        --text: #f0f0f0;
                }

                body {
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                        background: var(--bg);
                        color: var(--text);
                        margin: 0;
                        height: 100vh;
                        display: flex;
                        flex-direction: column;
                        overflow: hidden;
                }

                /* BARRA SUPERIOR */
                .header {
                        height: 60px;
                        background: var(--panel);
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 0 15px;
                        border-bottom: 1px solid #333;
                        z-index: 100;
                        transition: transform 0.3s;
                }

                .header.fullscreen-hide {
                        transform: translateY(-100%);
                }

                #page-center {
                        font-weight: bold;
                        color: var(--primary);
                        letter-spacing: 1px;
                        font-size: 0.9rem;
                }

                /* VISOR PRINCIPAL */
                #viewer-container {
                        flex: 1;
                        overflow: auto;
                        display: flex;
                        justify-content: center;
                        align-items: flex-start;
                        padding: 10px;
                        background: #121212;
                }

                #canvas-box {
                        position: relative;
                        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
                }

                canvas {
                        display: block;
                        max-width: 100%;
                        height: auto;
                }

                /* BOTONES FLOTANTES */
                .floating-controls {
                        position: fixed;
                        bottom: 100px;
                        right: 20px;
                        display: flex;
                        flex-direction: column;
                        gap: 15px;
                        z-index: 200;
                }

                .circle-btn {
                        width: 55px;
                        height: 55px;
                        border-radius: 50%;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
                        border: none;
                        cursor: pointer;
                }

                #lens-btn {
                        background: white;
                        border: 3px solid var(--primary);
                }

                #fs-btn {
                        background: var(--panel);
                        color: white;
                        border: 2px solid #444;
                        font-size: 1.2rem;
                }

                /* BARRA INFERIOR */
                .footer {
                        height: 70px;
                        background: var(--panel);
                        display: flex;
                        justify-content: space-around;
                        align-items: center;
                        border-top: 1px solid #333;
                        transition: transform 0.3s;
                }

                .footer.fullscreen-hide {
                        transform: translateY(100%);
                }

                .nav-btn {
                        background: #2a2a2a;
                        border: none;
                        color: white;
                        padding: 10px 25px;
                        border-radius: 12px;
                        font-size: 1rem;
                        font-weight: bold;
                        cursor: pointer;
                }
        </style>
</head>

<body id="main-body">

        <div class="header" id="header">
                <button onclick="document.getElementById('file-in').click()"
                        style="background:var(--primary); border:none; color:white; padding:8px 15px; border-radius:8px; font-weight:bold;">üìÅ
                        ABRIR</button>
                <div id="page-center">P√ÅGINA 0 / 0</div>
                <input type="file" id="file-in" style="display:none" accept="application/pdf">
                <div style="width: 50px;"></div>
        </div>

        <div class="floating-controls">
                <button id="fs-btn" class="circle-btn" onclick="toggleFullScreen()" title="Pantalla Completa">‚õ∂</button>
                <button id="lens-btn" class="circle-btn" onclick="captureToLens()">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/f/f7/Google_Lens_2021_logo.svg"
                                width="30">
                </button>
        </div>

        <div id="viewer-container" onclick="handleViewClick()">
                <div id="canvas-box">
                        <canvas id="pdf-render"></canvas>
                </div>
        </div>

        <div class="footer" id="footer">
                <button class="nav-btn" onclick="movePage(-1)">ANTERIOR</button>
                <button class="nav-btn" onclick="movePage(1)">SIGUIENTE</button>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

        <script>
                let pdfDoc = null, pageNum = 1, isRendering = false;
                const canvas = document.getElementById('pdf-render');
                const ctx = canvas.getContext('2d');

                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

                document.getElementById('file-in').onchange = e => {
                        const file = e.target.files[0];
                        const reader = new FileReader();
                        reader.onload = function () {
                                pdfjsLib.getDocument(new Uint8Array(this.result)).promise.then(pdf => {
                                        pdfDoc = pdf;
                                        render(1);
                                });
                        };
                        reader.readAsArrayBuffer(file);
                };

                async function render(num) {
                        if (isRendering || !pdfDoc) return;
                        isRendering = true;
                        pageNum = num;
                        const page = await pdfDoc.getPage(num);
                        const viewport = page.getViewport({ scale: 2.0 }); // Calidad Retina
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        await page.render({ canvasContext: ctx, viewport: viewport }).promise;
                        document.getElementById('page-center').innerText = `P√ÅGINA ${num} / ${pdfDoc.numPages}`;
                        isRendering = false;
                }

                function movePage(delta) {
                        const next = pageNum + delta;
                        if (next > 0 && next <= pdfDoc.numPages) render(next);
                }

                // --- FUNCIONES NUEVAS ---

                // Pantalla Completa Real
                function toggleFullScreen() {
                        if (!document.fullscreenElement) {

                                document.documentElement.requestFullscreen();
                                hideUI();
                        } else {
                                if (document.exitFullscreen) {
                                        document.exitFullscreen();
                                        showUI();
                                }
                        }
                }

                // Ocultar/Mostrar barras al tocar el centro (Kindle Style)
                function handleViewClick() {
                        const header = document.getElementById('header');
                        header.classList.toggle('fullscreen-hide');
                        document.getElementById('footer').classList.toggle('fullscreen-hide');
                }

                function hideUI() {
                        document.getElementById('header').classList.add('fullscreen-hide');
                        document.getElementById('footer').classList.add('fullscreen-hide');
                }

                function showUI() {
                        document.getElementById('header').classList.remove('fullscreen-hide');
                        document.getElementById('footer').classList.remove('fullscreen-hide');
                }

                // Google Lens Integration
                function captureToLens() {
                        if (!pdfDoc) return;
                        const imageData = canvas.toDataURL("image/jpeg", 0.9);
                        fetch(imageData).then(res => res.blob()).then(blob => {
                                const file = new File([blob], "capture.jpg", { type: "image/jpeg" });
                                if (navigator.share) {
                                        navigator.share({ files: [file], title: 'Google Lens Scan' });
                                } else {
                                        const link = document.createElement('a');
                                        link.download = 'lens_scan.jpg';
                                        link.href = imageData;
                                        link.click();
                                }
                        });
                }
        </script>
</body>

</html>